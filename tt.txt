ТЗ: Мониторинг внешних API
Цель:
Создать API который периодически делает запросы к внешним сервисам (CoinGecko, GitHub, JSONPlaceholder и т.д.), логирует результаты и предоставляет статистику.

Этап 1: FastAPI + PostgreSQL
База данных:
Таблица api_logs:

id — INT, primary key
url — VARCHAR (полный URL запроса)
method — VARCHAR (GET, POST...)
status_code — INT (200, 404, 500... или 0 если ошибка)
response_time_ms — FLOAT
timestamp — TIMESTAMP
success — BOOLEAN (true если статус 2xx)
error_message — TEXT (если запрос упал)


Функционал:
1. Фоновая задача:

Запускается при старте приложения
Каждые N секунд (настраиваемо) делает GET-запросы к списку URL
Сохраняет результаты в БД

2. Список URL для мониторинга хранится:

В коде (список переменных)
Или в БД (таблица monitored_urls)

3. API эндпоинты:

GET / — инфо о сервисе
GET /logs/ — список всех логов (с пагинацией, фильтрами)
GET /logs/{id} — один лог
GET /stats/summary — общая статистика (всего запросов, успешных, failed, средн. время)
GET /stats/by-url — статистика по каждому URL
GET /stats/uptime — uptime каждого сервиса (% успешных запросов)
GET /stats/slowest — топ-10 самых медленных запросов


Какие API мониторить (примеры):

CoinGecko — курсы криптовалют

https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd


JSONPlaceholder — тестовые данные

https://jsonplaceholder.typicode.com/posts
https://jsonplaceholder.typicode.com/users


GitHub API

https://api.github.com/repos/python/cpython


HTTPBin — тестовый сервис

https://httpbin.org/get
https://httpbin.org/delay/2 (искусственная задержка)


REST Countries

https://restcountries.com/v3.1/name/russia




Требования:

Фоновая задача не должна блокировать API
Запросы к внешним API должны быть асинхронными
Если внешний API не отвечает > 10 секунд — считать ошибкой
Логи старше 30 дней можно удалять (опционально)


Критерии успеха:

Приложение запускается
Автоматом начинает мониторить список URL
Логи сохраняются в PostgreSQL
Статистика показывает реальные данные
Можно увидеть когда какой сервис был недоступен


Это то что тебе нужно?
Твой FastAPI САМ делает запросы к публичным API, логирует результаты, показывает статистику.
Никаких webhooks, никаких сторонних сервисов которые шлют тебе что-то. Всё под твоим контролем.
Подходит?


1. Функция которая получает запрос
2. Функция, которая вносит значения в БД
3. Ручки, которые выводят результат из БД






1. Арбитражный сканер
text
GET /api/v1/arbitrage/{symbol}
Что делает: Находит разницу цен на одной паре между всеми биржами в реальном времени.
Сложность: Нужно одновременно запросить все биржи, сравнить, вычислить %, отфильтровать значимые (>0.5%).

2. Историческая волатильность
text
GET /api/v1/analytics/volatility/{symbol}?period=24h&exchange=all
Что делает: Рассчитывает стандартное отклонение цены за период.
Сложность: Статистика по тысячам записей, разные периоды (1h, 24h, 7d), кэширование тяжёлых вычислений.

3. Прогноз на основе скользящих средних
text
GET /api/v1/predictions/{symbol}?ma_short=20&ma_long=50
Что делает: Считает MA(20) и MA(50), определяет "золотое/смертельное пересечение".
Сложность: Временные ряды, оконные функции SQL, бизнес-логика сигналов.

4. Корреляция пар
text
GET /api/v1/correlation?pair1=BTCUSDT&pair2=ETHUSDT&period=7d
Что делает: Считает коэффициент корреляции Пирсона между двумя парами.
Сложность: Математика, обработка временных рядов разной длины, оптимизация запросов.

5. Аномалии цен (спайки)
text
GET /api/v1/anomalies/{exchange}?threshold=2.5&period=1h
Что делает: Находит резкие скачки цены >2.5σ от среднего.
Сложность: Статистические выбросы, оконные функции, производительность.

6. Лучшая цена для сделки
text
POST /api/v1/best-execution
Body: {"symbol": "BTCUSDT", "amount": 1.5, "side": "buy"}
Что делает: Рассчитывает на какой бирже выгоднее купить/продать N монет с учётом объема.
Сложность: Агрегация по всем биржам, учёт стакана (если добавишь), расчёт стоимости.

7. Тепловая карта рынка
text
GET /api/v1/heatmap?timeframe=1h&exchanges=binance,kraken
Что делает: Возвращает матрицу "биржа × валюта" с % изменениями за период.
Сложность: Pivot-таблица в SQL, группировка, преобразование данных для визуализации.